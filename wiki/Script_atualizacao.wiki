#summary Script de atualização do sistema.
#labels script,atualização,shell

= Introdução =

Script de atualização do sistema v1.1 27/jan/2010, 

(não esta 100% funcional ainda.)
pretendo atualiza-lo diariamente, contemplando desde a instalação até a atualização.

= Detalhes =
{{{
#!/bin/bash

CMD_GBAK="/opt/firebird/bin/gbak"
Principal() {
until []; do
echo '##########################################################'
echo '#                                                        #'
echo '#      Este procedimento atualizara o freedom            #'
echo '#                                                        #'
echo '##########################################################'
echo ''
echo ''
echo '	  1 - Backup das bases de dados'
echo '	  2 - Copia novos arquivos p/ /opt/freedom'
echo '	  3 - Copia novos arquivos p/ /opt/windows'
echo '	  4 - Atualiza Banco de dados'
echo '	  5 - Abre o IbExpert.exe'
echo '	  6 - Abre o IbDbComp.exe'
echo '	  0 - Sair'
echo ''
echo -n '             Selecione a opção desejada:' 
read opc
echo ''
case $opc in
   '1')  backup ;;
   '2')  cpLinux ;;
   '3')  cpWindows ;;
   '4')  updateDb ;;
   '5')  openIb ;;
   '6')  openDbComp ;;
   '0') exit ;;

   *) echo "!!!!!!! Entre com um parametro valido!!!" ;;
esac 
done
}



	backup(){
		echo ''
		echo '#--------------------------------------------------------#'
		echo '#     Este procedimento realizara o backup das bases     #'
		echo '#     de dados (Freedom.FDB, nfe.fdb, security.fdb)      #'
		echo '#--------------------------------------------------------#'
		echo 'Entre com a senha sysdba p/ confirmar: '
		stty -echo
		read pass
		stty echo
		/opt/firebird/bin/gbak -B localhost:/opt/firebird/1.5/dados/freedom.fdb /bkp/FreedomFDB/freedom-`date +%Y-%m-%d-%H.%M`.fbk -user sysdba -pass $pass
		/opt/firebird/bin/gbak -B localhost:/opt/firebird/1.5/dados/stpnfe.fdb /bkp/FreedomFDB/stpnfe-`date +%Y-%m-%d-%H.%M`.fbk -user sysdba -pass $pass
		/opt/firebird/bin/gbak -B localhost:/opt/firebird/1.5/security.fdb /bkp/FreedomFDB/security-`date +%Y-%m-%d-%H.%M`.fbk -user sysdba -pass $pass
	}

	cpLinux(){

		echo '#--------------------------------------------------------#'
		echo '#     Efetuando backup dos arquivos antigos              #'
		echo '#--------------------------------------------------------#'
		mkdir -p /opt/freedom/lib/bak
		mkdir -p /opt/freedom/bin/bak
		cp /opt/freedom/lib/*.jar /opt/freedom/lib/bak
		cp /opt/freedom/bin/*.sh /opt/freedom/bin/bak
		echo '#--------------------------------------------------------#'
		echo '#     Copiando novos arquivos para /opt/freedom...       #'
		echo '#--------------------------------------------------------#'
		cp /opt/eclipse/workspace/freedom/lib/*.jar /opt/freedom/lib
		cp /opt/eclipse/workspace/freedom-fw1/lib/*.jar /opt/freedom/lib
		cp /opt/eclipse/workspace/freedom/lib/exec/*.sh /opt/freedom/bin

	}
	cpWindows(){
			
		echo '#--------------------------------------------------------#'
		echo '#     Efetuando backup dos arquivos antigos              #'
		echo '#--------------------------------------------------------#'
		mkdir -p /opt/windows/lib/bak
		mkdir -p /opt/windows/bin/bak
		cp /opt/windows/lib/*.jar /opt/windows/lib/bak
		cp /opt/windows/bin/*.bat /opt/windows/bin/bak
		echo '#--------------------------------------------------------#'
		echo '#     Copiando novos arquivos para /opt/windows...       #'
		echo '#--------------------------------------------------------#'
		mkdir -p /opt/windows
		mkdir -p /opt/windows/lib
		mkdir -p /opt/windows/bin

		cp /opt/eclipse/workspace/freedom/lib/*.jar /opt/windows/lib
		cp /opt/eclipse/workspace/freedom-fw1/lib/*.jar /opt/windows/lib
		cp /opt/eclipse/workspace/freedom/lib/exec/*.bat /opt/windows/bin


	}
	upgradeDb(){
		backup
		echo '#--------------------------------------------------------#'
		echo '#    .bkp to .fdb em /opt/firebird/data/desenv           #'
		echo '#--------------------------------------------------------#'

		rm -f /tmp/freedom.fbk
		unzip -o /dados/freedom/dados/estrutura/freedom.zip -d/
		mkdir --parents /opt/firebird/dados/desenv/
		$CMD_GBAK -C -R -P 3050 /tmp/freedom.fbk localhost:/opt/firebird/dados/desenv/freedom.fdb

		#openIb;
		#openDbComp;
	}
	openIb(){
		wine /opt/ibdbcomp/IbDbComp.exe
	}
	openDbComp(){
		wine ~/.wine/drive_c/Arquivos\ de\ programas/HK-Software/IBExpert/ibexpert.exe
	}
Principal
}}}